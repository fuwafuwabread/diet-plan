<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>食事×買い物 自動連動</title>
<style>
body{
  font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP";
  background:#0b1020;
  color:#e9ecf5;
  margin:0;
  padding:20px;
}
h1{font-size:20px;margin-bottom:10px}
.card{
  background:#111a33;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.1)}
th{color:#aab3d6;text-align:left}
button{
  background:#7c5cff;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 12px;
  margin-right:6px;
}
button.alt{background:#444}
label{display:block;margin:6px 0}
input[type=checkbox]{transform:scale(1.2)}
.item{display:flex;align-items:center;gap:8px}
.item.done{text-decoration:line-through;color:#777}
</style>
</head>
<body>

<h1>生活インフラ｜食事 × 買い物</h1>

<div class="card">
  <b>① 今週の献立チェック</b>
  <table>
    <tr><th>曜日</th><th>昼</th><th>夜</th><th>実行</th></tr>
    <tr><td>月</td><td>A</td><td>D</td><td><input type="checkbox" data-day="mon"></td></tr>
    <tr><td>火</td><td>B</td><td>E</td><td><input type="checkbox" data-day="tue"></td></tr>
    <tr><td>水</td><td>C</td><td>チート</td><td><input type="checkbox" data-day="wed"></td></tr>
    <tr><td>木</td><td>A</td><td>D</td><td><input type="checkbox" data-day="thu"></td></tr>
    <tr><td>金</td><td>B</td><td>E</td><td><input type="checkbox" data-day="fri"></td></tr>
    <tr><td>土</td><td>C</td><td>チート</td><td><input type="checkbox" data-day="sat"></td></tr>
    <tr><td>日</td><td>A</td><td>F</td><td><input type="checkbox" data-day="sun"></td></tr>
  </table>
</div>

<div class="card">
  <b>② 表示範囲</b><br>
  <button onclick="setRange('today')">今日</button>
  <button onclick="setRange('next')">今日＋明日</button>
  <button class="alt" onclick="setRange('week')">今週残り</button>
</div>

<div class="card">
  <b>③ 必要な買い物</b>
  <div id="shopping"></div>
</div>

<script>
/* 献立定義 */
const meals = {
  A:["米","鮭","サラダ","味噌"],
  B:["そば","卵","わかめ"],
  C:["卵","納豆","米"],
  D:["豚肉","白菜","きのこ","豆腐"],
  E:["鶏肉","もやし"],
  F:["豆腐","ツナ","キムチ"]
};

const plan = {
  mon:["A","D"],
  tue:["B","E"],
  wed:["C"],
  thu:["A","D"],
  fri:["B","E"],
  sat:["C"],
  sun:["A","F"]
};

let range = "week";

/* 保存 */
const state = JSON.parse(localStorage.getItem("diet_state")||"{}");

/* 初期反映 */
document.querySelectorAll("input[type=checkbox]").forEach(cb=>{
  cb.checked = state[cb.dataset.day]||false;
  cb.onchange = ()=>{
    state[cb.dataset.day]=cb.checked;
    save();
  };
});

function setRange(r){
  range=r;
  render();
}

function save(){
  localStorage.setItem("diet_state",JSON.stringify(state));
  render();
}

function render(){
  const days = Object.keys(plan);
  const todayIndex = new Date().getDay()-1;
  const activeDays = days.filter((d,i)=>{
    if(!state[d]) return false;
    if(range==="today") return i===todayIndex;
    if(range==="next") return i===todayIndex||i===todayIndex+1;
    return i>=todayIndex;
  });

  const items = new Set();
  activeDays.forEach(d=>{
    plan[d].forEach(m=>{
      if(meals[m]) meals[m].forEach(i=>items.add(i));
    });
  });

  const el=document.getElementById("shopping");
  el.innerHTML="";
  if(items.size===0){
    el.textContent="チェックされた日がありません";
    return;
  }
  items.forEach(i=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<input type="checkbox"> ${i}`;
    el.appendChild(div);
  });
}

render();
</script>

</body>
</html>
